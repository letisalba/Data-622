---
title: "Data 622 - Homework 2"
author: "Leticia Salazar"
date: "October 29, 2023"
output: 
  html_document:
    theme: sandstone
    highlight: haddock
  pdf_document:
    latex_engine: xelatex
    dev: cairo_pdf
---

```{r setup, include=FALSE, out.width="50%"}
knitr::opts_chunk$set(echo = TRUE)
```
$~$

#### Pre-work
1. Read this blog: https://decizone.com/blog/the-good-the-bad-the-ugly-of-using-decision-trees which shows some of the issues with decision trees. 
2. Choose a dataset from a source in Assignment #1, or another dataset of your choice.


#### Assignment work
1. Based on the latest topics presented, choose a dataset of your choice and create a Decision Tree where you can solve a classification problem and predict the outcome of a particular feature or detail of the data used.
2. Switch variables* to generate 2 decision trees and compare the results. Create a random forest for regression and analyze the results.
3. Based on real cases where desicion trees went wrong, and 'the bad & ugly' aspects of decision trees (https://decizone.com/blog/the-good-the-bad-the-ugly-of-using-decision-trees), how can you change this perception when using the decision tree you created to solve a real problem?


#### Deliverable
1. Essay (minimum 500 word document)
Write a short essay explaining your analysis, and how you would address the concerns in the blog (listed in pre-work)
2. Exploratory Analysis using R or Python (submit code + errors + analysis as notebook or copy/paste to document)

Due Date: Sunday October 29th, end of day
* We are trying to just train 2 different decision trees - so swicth the feature used for the first node (split) to force a different decision tree.

$~$

#### Load Libraries:
Below are the libraries used to complete this assignment
```{r, cache=FALSE, results=FALSE, warning=FALSE, comment=FALSE}
library(tidyverse) # data prep
library(skimr) # data prep
library(rpart) # decision tree package
library(rpart.plot) # decision tree display package
library(knitr) # kable function for table
library(tidyr) # splitting data
library(ggplot2) # graphing
library(hrbrthemes) # chart customization
library(gridExtra) # layering charts
library(stringr) # data prep
library(tidymodels) # predictions
```

$~$

#### Load Data:
The data chosen is from [Kaggle.com](https://www.kaggle.com/datasets/uciml/red-wine-quality-cortez-et-al-2009) called Red Wine Quality. The data set is included in my [GitHub](https://github.com/letisalba/Data-622/tree/master/Homework-2) and read into R.
```{r, loading data, echo = FALSE}
wine_df <- read.csv("https://raw.githubusercontent.com/letisalba/Data-622/master/Homework-2/csv/winequality-red.csv")
```

```{r, echo=FALSE, kable.opts=list(caption="data frame is now printed using `kable`.")}
# display the dataset
kable(head(wine_df), align = "l", table.attr = "style='width:30%;'")
```

$~$

### The Data:

Based on the description from Kaggle, the two datasets are related to red and white variants of the Portuguese "Vinho Verde" wine. For more details, consult: http://www.vinhoverde.pt/en/ or the reference [Cortez et al., 2009].  Due to privacy and logistic issues, only physicochemical (inputs) and sensory (the output) variables are available (e.g. there is no data about grape types, wine brand, wine selling price, etc.).

These datasets can be viewed as classification or regression tasks.  The classes are ordered and not balanced (e.g. there are many more normal wines than excellent or poor ones). Outlier detection algorithms could be used to detect the few excellent or poor wines. Also, we are not sure if all input variables are relevant. So it could be interesting to test feature selection methods.

Input variables (based on physicochemical tests):
1 - fixed acidity
2 - volatile acidity
3 - citric acid
4 - residual sugar
5 - chlorides
6 - free sulfur dioxide
7 - total sulfur dioxide
8 - density
9 - pH
10 - sulphates
11 - alcohol
Output variable (based on sensory data):
12 - quality (score between 0 and 10)

$~$

### Data Exploration:

Using the `skimr` library we can obtain a quick summary statistic of the dataset. It has 1599 values with 12 variables all numeric.
```{r, echo=FALSE}
# summary of the dataset
skim(wine_df)
```
$~$

##### Let's take a look at the distributions of the numeric variables for the small data set:
```{r, fig.height=12, fig.width=12, warning=FALSE, echo=FALSE, message=FALSE, fig.align='center'}
# histogram for fixed.acidity
p1 <- wine_df %>% 
ggplot( aes(x=fixed.acidity)) +
    geom_histogram(fill="#69b3a2", color="#e9ecef", alpha=0.8) +
    ggtitle("Fixed Acidity") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for volatile.acidity
p2 <- wine_df %>% 
ggplot( aes(x=volatile.acidity)) +
    geom_histogram(fill="#69a0b3", color="#e9ecef", alpha=0.8) +
    ggtitle("Volatile Acidity") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for citric.acid
p3 <- wine_df %>% 
ggplot( aes(x=citric.acid)) +
    geom_histogram(fill="#696fb3", color="#e9ecef", alpha=0.8) +
    ggtitle("Citric Acid") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for residual.sugar
p4 <- wine_df %>% 
ggplot( aes(x=residual.sugar)) +
    geom_histogram(fill="#b369ae", color="#e9ecef", alpha=0.8) +
    ggtitle("Residual Sugar") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for chlorides
p5 <- wine_df %>% 
ggplot( aes(x=chlorides)) +
    geom_histogram(fill="#77b369", color="#e9ecef", alpha=0.8) +
    ggtitle("Chlorides") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for free.sulfur.dioxide
p6 <- wine_df %>% 
ggplot( aes(x=free.sulfur.dioxide)) +
    geom_histogram(fill="#b37e69", color="#e9ecef", alpha=0.8) +
    ggtitle("Free Sulfur Dioxide") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for total.sulfur.dioxide
p7 <- wine_df %>% 
ggplot( aes(x=total.sulfur.dioxide)) +
    geom_histogram(fill="#c96976", color="#e9ecef", alpha=0.8) +
    ggtitle("Total Sulfur Dioxide") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for density
p8 <- wine_df %>% 
ggplot( aes(x=density)) +
    geom_histogram(fill="#ffbe8c", color="#e9ecef", alpha=0.8) +
    ggtitle("Density") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for pH
p9 <- wine_df %>% 
ggplot( aes(x=pH)) +
    geom_histogram(fill="#ecff8c", color="#e9ecef", alpha=0.8) +
    ggtitle("pH") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for sulphates
p10 <- wine_df %>% 
ggplot( aes(x=sulphates)) +
    geom_histogram(fill="#8cffcb", color="#e9ecef", alpha=0.8) +
    ggtitle("Sulphates") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for alcohol
p11 <- wine_df %>% 
ggplot( aes(x=alcohol)) +
    geom_histogram(fill="#D0CECE", color="#e9ecef", alpha=0.8) +
    ggtitle("Alcohol") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# histogram for quality
p12 <- wine_df %>% 
ggplot( aes(x=quality)) +
    geom_histogram(fill="#CB747E", color="#e9ecef", alpha=0.8) +
    ggtitle("Quality") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )

# displaying the histograms
par(mfrow = c(3, 4))
grid.arrange(p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12)
```


##### Some notes on the visualizations above: 

* Most of the distributions for the variables are right skewed with the exception of Density and pH
* Density and pH have more of a normal distribution
* Citric Acid has a more uniform distribution

$~$

### Data Preparation:

Now that I've visualized the data I want to do one minor change to the columns. Most of the columns have a "." and I'm changing it to an "_".

```{r, echo=FALSE, warning=FALSE}
# change the names of the columns
oldnames = c("fixed.acidity", "volatile.acidity", "citric.acid", "residual.sugar", "chlorides", "free.sulfur.dioxide", "total.sulfur.dioxide", "density", "pH", "sulphates","alcohol", "quality")
newnames = c("Fixed_Acidity", "Volatile_Acidity", "Citric_Acid", "Residual_Sugar", "Chlorides", "Free_Sulfur_Dioxide", "Total_Sulfur_Dioxide", "Density", "pH", "Sulphates", "Alcohol", "Quality")

# input the change
wine_df2 <- wine_df %>% 
  rename_at(vars(oldnames), ~ newnames)

# display the dataset
kable(head(wine_df2), align = "l", table.attr = "style='width:30%;'")
```


$~$

### Model Building:


$~$

### Conclusion: